# 后端设计思路

## 对象

终端：终端Node<br>
连接点：连接点Node<br>
节点：终端和连接点<br>
信道：Link<br>

## 发送

终端$P$进入发送态，先生成一个以动画Node表示的首帧，并沿总线广播，$P$正常结束发送时，再生成一个以动画Node表示的尾帧，同样沿总线广播。

首帧经过的节点（不排除$P$本身和目标终端）的占用者置为$P$,若一个信道的两个连接点的占用者都被置为$P$，则该信道的占用者置为$P$。

尾帧经过的节点的占用者若为$P$，则置其占用者为空。

## 接收

终端$P$的占用者若为空，则当以$P$为目标终端的首帧到达$P$时，$P$进入接收态，直到其尾帧正常到达或检测到碰撞（碰撞信息到达）。

## 监听

各终端始终处于监听态，若终端$P$占用者为空且不处于退避期，则允许$P$进入发送态。

## 碰撞

终端$P$的首帧在经过节点$N$时,若其占用者不为空，则在$N$中产生碰撞源，摧毁$P$的首帧，并生成一个以动画Node表示的碰撞信号，并沿总线广播。
终端$P$的尾帧在经过节点$N$时,若其占用者不为空或$P$，则摧毁$P$的尾帧。

碰撞信号经过的节点若不为“碰撞”则置为“碰撞”，终端占用者在置为“碰撞”后进入退避期，连接点占用者在置为“碰撞”后半个争用期后置为“空”（以避免碰撞点离散化到节点所产生误差带来的连锁反应）。

## 概念具象化

争用期/端到端传播时延：某终端$P$发送的首帧Node通过广播到达并置所有其他终端的占用者为终端$P$最少所需时间的两倍。

## 注

1.信道和节点实际上只存在忙与空闲两个状态，记录占用者的目的是方便可视化。<br>
2.题干的传输进一步划分为发送和接收。